import datetime, requests, random

adventPics = [
    [2047,2047,0,0,21183,21183,0,0,0,0,21183,21183,0,0,0,64842,0,0,0,2047,2047,0,0,0,0,0,0,0,0,0,21183,21183,2047,2047,0,0,0,0,0,0,0,0,21183,21183,0,0,65504,65504,65504,0,0,0,0,0,0,45055,45055,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,63488,63488,63488,0,0,0,0,0,0,45055,45055,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,63519,0,0,0,0,0,0,0,0,0,0,0,0,0,2047,2047,0,0,0,0,0,0,2047,2047,0,0,0,0,0,0,65525,65525,65525,65525,65525,0,0,0,0,0,0,0,0,0,0,0,2047,2047,0,21183,0,0,0,0,2047,2047,0,0,0,0,0,0,65525,65525,65525,65525,65525,0,0,21183,21183,0,0,0,0,0,0,0,0,0,0,21183,0,0,0,0,0,0,0,0,45055,45055,0,0,65525,65525,65525,65525,0,0,0,21183,21183,0,0,0,0,21183,21183,0,0,0,0,1344,1344,1344,1344,1344,1344,1344,1344,1344,1344,1344,1344,1344,1344,65525,65525,65525,1344,1344,1344,1344,1344,1344,1344,1344,1344,1344,1344,1344,1344,1344,1344],
    [21855,2047,0,0,21183,21183,0,0,0,64842,0,0,0,0,22527,22527,0,0,0,0,0,0,64842,0,0,0,0,0,0,0,21183,21183,2047,21855,0,0,0,0,0,0,65514,65514,65514,0,0,0,22527,22527,0,0,0,0,0,65514,65514,65514,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,63488,63488,63488,0,0,0,0,0,0,0,0,0,0,63488,63488,63488,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64191,0,0,0,0,0,0,0,0,0,0,0,0,64191,0,0,0,0,0,0,2047,21855,0,0,0,0,22527,22527,0,0,65525,65525,65525,65525,65525,0,0,0,0,0,0,0,0,65525,65525,65525,65525,65525,0,0,0,0,21855,2047,0,21183,0,0,22527,22527,0,0,65525,65525,65525,65525,65525,0,0,0,0,0,22527,21855,0,65525,65525,65525,65525,65525,0,0,0,0,0,0,0,21183,0,0,0,0,0,0,65525,65525,65525,65525,0,0,1055,1055,0,0,21855,22527,0,65525,65525,65525,65525,0,0,21183,21183,0,0,0,0,1344,1344,1344,1344,1344,1344,1344,1344,65525,65525,65525,1344,1344,1344,1344,1344,1344,1344,1344,1344,1344,65525,65525,65525,1344,1344,1344,1344,1344,1344,1344,1344],
    [21855,2047,0,0,0,0,0,64842,0,0,0,22527,21855,0,0,0,64842,0,0,22527,22527,0,0,0,64842,0,0,0,0,0,21183,21183,2047,21855,0,0,0,0,65514,65514,65514,0,0,21855,22527,0,0,65514,65514,65514,0,0,0,0,0,65514,65514,65514,0,0,0,0,0,0,0,0,0,0,0,0,63488,63488,63488,0,0,0,0,0,0,63488,63488,63488,0,0,0,0,0,63488,63488,63488,0,0,0,0,0,0,0,0,0,0,0,0,0,64191,0,0,0,0,0,0,0,0,64191,0,0,0,0,0,0,0,64191,0,0,0,0,2047,21855,0,0,0,0,0,0,65525,65525,65525,65525,65525,0,0,0,0,65525,65525,65525,65525,65525,0,0,0,65525,65525,65525,65525,65525,0,0,21855,2047,0,21183,0,0,0,0,65525,65525,65525,65525,65525,0,0,0,0,65525,65525,65525,65525,65525,0,0,0,65525,65525,65525,65525,65525,0,0,0,0,0,21183,0,0,0,0,0,65525,65525,65525,65525,0,0,0,0,65525,65525,65525,65525,0,0,0,0,0,65525,65525,65525,65525,0,0,0,0,0,1344,1344,1344,1344,1344,1344,65525,65525,65525,1344,1344,1344,1344,1344,1344,65525,65525,65525,1344,1344,1344,1344,1344,65525,65525,65525,1344,1344,1344,1344,1344,1344],
    [21855,22527,0,0,64842,0,0,0,0,0,0,64842,0,0,22527,22527,0,0,0,64842,0,0,0,21855,22527,0,0,64842,0,0,1119,21183,2047,21855,0,65514,65514,65514,0,0,0,0,65514,65514,65514,0,0,0,0,0,65514,65514,65514,0,0,22527,21855,0,65514,65514,65514,0,0,0,0,0,0,63488,63488,63488,0,0,0,0,63488,63488,63488,0,0,0,0,0,63488,63488,63488,0,0,0,0,0,63488,63488,63488,0,0,0,0,0,0,0,64191,0,0,0,0,0,0,64191,0,0,0,0,0,0,0,64191,0,0,0,0,0,0,0,64191,0,0,0,0,0,0,65525,65525,65525,65525,65525,0,0,65525,65525,65525,65525,65525,0,0,0,65525,65525,65525,65525,65525,0,0,0,65525,65525,65525,65525,65525,0,0,21183,0,65525,65525,65525,65525,65525,0,0,65525,65525,65525,65525,65525,0,0,0,65525,65525,65525,65525,65525,0,0,0,65525,65525,65525,65525,65525,0,0,21183,0,65525,65525,65525,65525,0,0,0,0,65525,65525,65525,65525,0,0,0,0,65525,65525,65525,65525,0,0,0,65525,65525,65525,65525,0,0,0,1344,1344,1344,65525,65525,65525,1344,1344,1344,1344,65525,65525,65525,1344,1344,1344,1344,1344,65525,65525,65525,1344,1344,1344,1344,1344,65525,65525,65525,1344,1344,1344]
]

christmasPics = [
    [0,0,0,0,0,0,0,0,0,0,0,0,0,65504,65504,65504,65504,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,65504,1344,1344,65504,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1344,1344,1344,1344,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1344,1344,63488,1344,63488,1344,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1344,63488,1344,1344,1344,1344,1344,1344,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1344,1344,1344,1344,63488,1344,63488,1344,1344,1344,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,65504,0,0,65504,0,0,20480,20480,0,0,65504,0,0,65504,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,21152,21152,21152,63504,63504,63504,20480,20480,20480,20480,31,31,31,682,682,682,0,0,0,0,0,0,0,0,0],
    [0,0,0,65504,65504,0,0,0,0,0,0,0,0,0,63488,63488,63488,63488,0,0,0,0,0,0,65535,0,0,65504,65504,0,0,0,0,0,0,1344,1344,0,0,0,0,0,65535,0,0,63488,63488,63488,63488,63488,63488,0,0,0,0,0,0,0,0,1344,1344,0,0,0,0,0,63488,1344,31,1344,0,0,65535,0,0,0,43008,63488,65535,65535,65535,65535,65535,0,0,0,65535,0,0,0,1344,1344,63488,1344,0,0,0,0,1344,65504,1344,1344,0,0,0,0,0,0,63488,0,65535,65535,65535,65535,65535,65535,0,0,0,0,0,0,31,1344,1344,1344,0,0,0,65504,1344,1344,1344,63488,1344,0,0,65535,0,0,65535,0,64842,0,64842,0,64842,64842,0,0,0,65535,0,1344,1344,1344,65504,1344,1344,0,0,1344,31,1344,1344,1344,1344,0,0,0,0,0,65535,0,64842,54970,54970,54970,64842,0,0,0,0,0,0,63488,1344,1344,1344,31,1344,0,1344,63488,1344,1344,31,1344,63488,65504,0,0,0,0,0,0,54970,54970,43008,54970,54970,0,0,0,0,0,65504,1344,31,1344,1344,63488,1344,65504,0,0,0,43680,43680,0,0,0,0,0,65535,0,0,63488,63488,54970,54970,54970,63488,63488,0,0,65535,0,0,0,0,43680,43680,0,0,0],
    [0,0,0,1119,1119,1119,0,0,0,0,0,63488,63488,63488,0,0,0,0,0,2016,2016,2016,0,0,0,0,0,63504,63504,63504,0,0,0,0,1119,31,31,31,1119,0,0,0,63488,43008,43008,43008,63488,0,0,0,2016,1344,1344,1344,2016,0,0,0,63504,43018,43018,43018,63504,0,0,1119,31,65535,31,31,31,1119,0,63488,43008,65535,43008,43008,43008,63488,0,2016,1344,65535,1344,1344,1344,2016,0,63504,43018,65535,43018,43018,43018,63504,1119,31,65535,31,31,31,31,31,1119,43008,65535,43008,43008,43008,43008,43008,63488,1344,65535,1344,1344,1344,1344,1344,2016,43018,65535,43018,43018,43018,43018,43018,1119,31,65535,31,31,31,31,31,1119,43008,65535,43008,43008,43008,43008,43008,63488,1344,65535,1344,1344,1344,1344,1344,2016,43018,65535,43018,43018,43018,43018,43018,0,1119,31,65535,31,31,31,1119,0,63488,43008,65535,43008,43008,43008,63488,0,2016,1344,65535,1344,1344,1344,2016,0,63504,43018,65535,43018,43018,63504,63504,0,0,1119,31,31,31,1119,0,0,0,63488,43008,43008,43008,63488,0,0,0,2016,1344,1344,1344,2016,0,0,0,63504,43018,43018,63504,63504,0,0,0,0,1119,1119,1119,0,0,0,0,0,63488,63488,63488,0,0,0,0,0,2016,2016,2016,0,0,0,0,0,63504,63504,63504,0,0],
    [21855,22527,0,0,64842,0,0,0,0,0,0,64842,0,0,22527,22527,0,0,0,64842,0,0,0,21855,22527,0,0,64842,0,0,1119,21183,2047,21855,0,65514,65514,65514,0,0,0,0,65514,65514,65514,0,0,0,0,0,65514,65514,65514,0,0,22527,21855,0,65514,65514,65514,0,0,0,0,0,0,63488,63488,63488,0,0,0,0,63488,63488,63488,0,0,0,0,0,63488,63488,63488,0,0,0,0,0,63488,63488,63488,0,0,0,0,0,0,0,64191,0,0,0,0,0,0,64191,0,0,0,0,0,0,0,64191,0,0,0,0,0,0,0,64191,0,0,0,0,0,0,65525,65525,65525,65525,65525,0,0,65525,65525,65525,65525,65525,0,0,0,65525,65525,65525,65525,65525,0,0,0,65525,65525,65525,65525,65525,0,0,21183,0,65525,65525,65525,65525,65525,0,0,65525,65525,65525,65525,65525,0,0,0,65525,65525,65525,65525,65525,0,0,0,65525,65525,65525,65525,65525,0,0,21183,0,65525,65525,65525,65525,0,0,0,0,65525,65525,65525,65525,0,0,0,0,65525,65525,65525,65525,0,0,0,65525,65525,65525,65525,0,0,0,1344,1344,1344,65525,65525,65525,1344,1344,1344,1344,65525,65525,65525,1344,1344,1344,1344,1344,65525,65525,65525,1344,1344,1344,1344,1344,65525,65525,65525,1344,1344,1344]
]

silvesterPics = [
    [2047,2047,2047,2047,2047,2047,63488,63488,63488,63488,63488,63488,63488,63488,63488,63488,63488,63488,63488,63488,63488,63488,63488,63488,63488,63488,2047,2047,2047,2047,2047,2047,2047,2047,2047,2047,2047,63488,63488,63488,63488,63488,63488,63488,63488,63488,63488,63488,63488,63488,63488,63488,63488,63488,63488,63488,63488,63488,63488,2047,2047,2047,2047,2047,2047,2047,2047,2047,63488,63488,64512,64512,64512,64512,64512,64512,64512,64512,64512,64512,64512,64512,64512,64512,64512,64512,64512,64512,64512,64512,63488,63488,2047,2047,2047,2047,2047,2047,2047,63488,63488,64512,64512,64512,64512,64512,64512,64512,64512,64512,64512,64512,64512,64512,64512,64512,64512,64512,64512,64512,64512,64512,64512,63488,63488,2047,2047,2047,2047,2047,63488,63488,64512,64512,65504,65504,65504,65504,65504,65504,65504,65504,65504,65504,65504,65504,65504,65504,65504,65504,65504,65504,65504,65504,64512,64512,63488,63488,2047,2047,2047,63488,63488,64512,64512,65504,65504,65504,65504,65504,65504,65504,65504,65504,65504,65504,65504,65504,65504,65504,65504,65504,65504,65504,65504,65504,65504,64512,64512,63488,63488,2047,63488,63488,64512,64512,65504,65504,34784,34784,34784,34784,34784,34784,34784,34784,34784,34784,34784,34784,34784,34784,34784,34784,34784,34784,34784,34784,65504,65504,64512,64512,63488,63488,63488,64512,64512,65504,65504,34784,34784,34784,34784,34784,34784,34784,34784,34784,34784,34784,34784,34784,34784,34784,34784,34784,34784,34784,34784,34784,34784,65504,65504,64512,64512,63488],

]


def updateUlanzi(config, pic):
    uri = config.get("ulanzi.uri")
    headers = {
        'Content-Type': 'application/json',
    }
    json_data = {
        'switchAnimation': {
            'aktiv': True,
            'animation': 'random',
        },
        'bitmap': {
            'data': pic,
            'position': {
                'x': 0,
                'y': 0,
            },
            'size': {
                'width': 32,
                'height': 8,
            },
        }
    }
    response = requests.post(uri, headers=headers, json=json_data)
    response.raise_for_status()  # Wirft eine Ausnahme für einen Fehler in der HTTP-Antwort
    return



def first_advent(year):
    """Berechnet das Datum des ersten Advents für ein bestimmtes Jahr"""
    first_day_of_advent = datetime.date(year=year, month=12, day=1)
    days_until_first_sunday = 6 - first_day_of_advent.weekday()
    first_advent = first_day_of_advent + datetime.timedelta(days=days_until_first_sunday)
    return first_advent


def update(config):
    today = datetime.datetime.now()
    advent1 = first_advent(today.year)
    advent2 = (advent1 + datetime.timedelta(days=7))
    advent3 = (advent1 + datetime.timedelta(days=14))
    advent4 = (advent1 + datetime.timedelta(days=21))
    christmas = [datetime.date(today.year, month=12, day=24), datetime.date(today.year, month=12, day=25), datetime.date(today.year, month=12, day=26)]
    silvester = [datetime.date(today.year, month=12, day=31), datetime.date(today.year, month=1, day=1)]

    if today.date() in silvester:
        updateUlanzi(config, random.choice(silvesterPics))
        return True

    if today.date() in christmas:
        updateUlanzi(config, random.choice(christmasPics))
        return True

    if advent1 <= today.date() and today.date() < advent2:
        updateUlanzi(config, adventPics[0])
        return True
    if advent2 <= today.date() and today.date() < advent3:
        updateUlanzi(config, adventPics[1])
        return True
    if advent3 <= today.date() and today.date() < advent4:
        updateUlanzi(config, adventPics[2])
        return True
    if advent4 <= today.date() and today.date() < christmas[0]:
        updateUlanzi(config, adventPics[3])
        return True

    return False
